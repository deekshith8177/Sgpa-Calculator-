<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="google-site-verification" content="Dgs18esZaCa7yjB7hkQaNPkkQlFjp2MsLR30BznN3eo" />
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-192.png">
<title>SGPA Calculator</title>
<style>
  body { font-family: Arial, sans-serif; background:#f5f7fa; margin:0; padding:20px; }
  .container { max-width:800px; margin:auto; background:#fff; padding:25px; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.1); }
  h1 { text-align:center; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th, td { padding:10px; border-bottom:1px solid #ddd; }
  input { width:90%; padding:8px; border:1px solid #ccc; border-radius:6px; }
  button { padding:10px 16px; border:none; border-radius:8px; cursor:pointer; }
  .add { background:#e3e8ff; }
  .calc { background:#4f46e5; color:#fff; }
  .remove { background:#f3f4f6; }
  .result-box { background:#f8fafc; padding:15px; margin-top:20px; border-radius:8px; }
  @media (max-width:600px){ input{width:100%} }
</style>
</head>
<body>
<div class="container">
  <h1>SGPA Calculator</h1>

  <div style="margin-top:10px;">
    <label>Input Mode: </label>
    <select id="mode" onchange="render()">
      <option value="gp">Grade Points</option>
      <option value="marks">Marks</option>
    </select>
  </div>

  <table id="subjectTable" aria-label="Subjects">
    <thead>
      <tr>
        <th>Subject</th>
        <th>Credits</th>
        <th id="thirdCol">Grade Point</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
    <button class="add" onclick="addRow()">+ Add Subject</button>
    <button class="calc" onclick="calculateSGPA()">Calculate SGPA</button>
    <button onclick="exportCSV()">Export CSV</button>
    <button onclick="resetAll()">Reset</button>
  </div>

  <div id="result" class="result-box" role="region" aria-live="polite"></div>
</div>

<script>
let rows = 1;

function addRow() {
  const tbody = document.getElementById("tbody");
  const mode = document.getElementById("mode").value;

  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td><input id="name${rows}" placeholder="Subject ${rows}"></td>
    <td><input type="number" id="credits${rows}" value="3" min="0"></td>
    <td><input type="number" id="value${rows}" ${mode==='marks'?'max="100"':''} step="0.01"></td>
    <td><button class="remove" onclick="this.parentNode.parentNode.remove()">Remove</button></td>
  `;

  tbody.appendChild(tr);
  rows++;
}

function marksToGP(marks) {
  marks = Number(marks);
  if (isNaN(marks)) return 0;
  if (marks >= 90) return 10;
  if (marks >= 80) return 9;
  if (marks >= 70) return 8;
  if (marks >= 60) return 7;
  if (marks >= 50) return 6;
  if (marks >= 40) return 5;
  return 0;
}

function calculateSGPA() {
  const mode = document.getElementById("mode").value;
  const trList = document.querySelectorAll("#tbody tr");

  let totalCredits = 0;
  let weighted = 0;

  trList.forEach((tr) => {
    const credits = Number(tr.children[1].children[0].value) || 0;
    let val = Number(tr.children[2].children[0].value) || 0;

    if (mode === "marks") val = marksToGP(val);

    totalCredits += credits;
    weighted += credits * val;
  });

  if (totalCredits === 0) {
    document.getElementById("result").innerHTML = "<strong>Error:</strong> Enter valid credits.";
    return;
  }

  const sgpa = (weighted / totalCredits).toFixed(2);

  document.getElementById("result").innerHTML = `
    <div><strong>SGPA:</strong> ${sgpa}</div>
    <div style="margin-top:8px;color:#555"><small>Calculated as ∑(credit × gradePoint) / ∑credits. Use 'Grade Points' mode to enter your university's exact points if needed.</small></div>
  `;
}

function render() {
  document.getElementById("tbody").innerHTML = "";
  rows = 1;
  const mode = document.getElementById("mode").value;
  document.getElementById("thirdCol").innerText = mode === "gp" ? "Grade Point" : "Marks";
  addRow();
}

function resetAll() {
  render();
  document.getElementById("result").innerHTML = "";
}

function exportCSV() {
  const trList = document.querySelectorAll("#tbody tr");
  if (trList.length === 0) { alert("No subjects to export."); return; }

  const mode = document.getElementById("mode").value;
  const lines = [["Subject","Credits", mode === "gp" ? "GradePoint" : "Marks","UsedGradePoint"].join(",")];

  trList.forEach((tr, idx) => {
    const name = tr.children[0].children[0].value || `Subject ${idx+1}`;
    const credits = Number(tr.children[1].children[0].value) || 0;
    let raw = tr.children[2].children[0].value || "";
    let gp = mode === "gp" ? Number(raw)||0 : marksToGP(raw);

    // escape CSV fields
    const esc = (s) => (String(s).includes(",")||String(s).includes('"') ? `"${String(s).replace(/"/g,'""')}"` : s);
    lines.push([esc(name), credits, esc(raw), gp].join(","));
  });

  const csv = lines.join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "sgpa_export.csv";
  a.click();
  URL.revokeObjectURL(url);
}

render();
</script>
</body>
</html>
